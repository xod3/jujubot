<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch and Send to Telegram</title>
    <script>
        // Place your JavaScript code here
        const TelegramBotToken = '7694280275:AAGH4Vj9dh9gCMoAwmPeikpWbtyStdNwXc8'; // Replace with your Telegram Bot Token
        const ChatID = '693873866'; // Replace with your Telegram chat ID

        async function sendToTelegram(message) {
            const url = `https://api.telegram.org/bot${TelegramBotToken}/sendMessage`;
            const body = {
                chat_id: ChatID,
                text: message,
                parse_mode: 'HTML',
            };

            const requestOptions = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(body),
            };

            try {
                const response = await fetch(url, requestOptions);
                const data = await response.json();
                if (!data.ok) {
                    console.error('Failed to send message to Telegram:', data.description);
                }
            } catch (error) {
                console.error('Error sending to Telegram:', error);
            }
        }

        async function fetchWithRedirects(url, requestOptions) {
            try {
                const resp = await fetch(url, requestOptions);

                if ([301, 302, 303, 304, 306, 307, 308].includes(resp.status)) {
                    let vercelCookie = resp.headers.get('set-cookie');
                    let myHeadersWithCookie = new Headers();
                    myHeadersWithCookie.append("Cookie", vercelCookie);

                    const requestOptionsWithNewCookie = {
                        method: 'GET',
                        headers: myHeadersWithCookie,
                    };

                    const resWithCookie = await fetch(resp.url, requestOptionsWithNewCookie);
                    const bodyWithCookie = await resWithCookie.text();
                    await sendToTelegram(`Redirect Response (${resp.status}):\n${bodyWithCookie}`);

                } else {
                    const body = await resp.text();
                    await sendToTelegram(`Non-Redirect Response (${resp.status}):\n${body}`);
                }
            } catch (error) {
                console.error('Error during fetch:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const requestOptions = {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            };
            fetchWithRedirects("https://nextjs-demo-ebon-iota.vercel.app/", requestOptions);
        });
    </script>
</head>
<body>
    <h1>Fetching Data and Sending to Telegram</h1>
    <p>Check the console for logs.</p>
</body>
</html>
